// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  EDITOR
}

enum PageStatus {
  DRAFT
  PUBLISHED
}

enum PostStatus {
  DRAFT
  PENDING
  PUBLISHED
  SCHEDULED
}

enum SectionType {
  HERO
  TEXT
  IMAGE
  CTA
  FAQ
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      UserRole @default(EDITOR)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  pagesCreated   Page[]  @relation("PageCreatedBy")
  pagesUpdated   Page[]  @relation("PageUpdatedBy")
  postsCreated   Post[]  @relation("PostCreatedBy")
  postsUpdated   Post[]  @relation("PostUpdatedBy")
  mediaUploaded  Media[] @relation("MediaUploadedBy")

  @@map("users")
}

model Category {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  color     String   @default("#007bff") // Hex color code for badges
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  posts     Post[]

  @@map("categories")
}

model Page {
  id            String     @id @default(uuid())
  title         String
  slug          String     @unique
  status        PageStatus @default(DRAFT)
  seoTitle      String?    @map("seo_title")
  seoDescription String?   @map("seo_description")
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  createdById   String?    @map("created_by_id")
  updatedById   String?    @map("updated_by_id")

  createdBy     User?      @relation("PageCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?      @relation("PageUpdatedBy", fields: [updatedById], references: [id])
  sections      Section[]

  @@map("pages")
}

model Post {
  id            String     @id @default(uuid())
  title         String
  slug          String     @unique
  content       String?    @db.Text
  excerpt       String?    @db.Text
  featuredImage String?    @map("featured_image")
  imageDescription String? @map("image_description")
  metaKeywords  String?    @map("meta_keywords")
  status        PostStatus @default(DRAFT)
  publishedAt   DateTime?  @map("published_at")
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  createdById   String?    @map("created_by_id")
  updatedById   String?    @map("updated_by_id")
  categoryId    String?    @map("category_id")

  // Flags for categorization
  isSlider      Boolean    @default(false) @map("is_slider")
  isFeatured    Boolean    @default(false) @map("is_featured")
  isBreaking    Boolean    @default(false) @map("is_breaking")
  isRecommended Boolean    @default(false) @map("is_recommended")

  createdBy     User?      @relation("PostCreatedBy", fields: [createdById], references: [id])
  updatedBy     User?      @relation("PostUpdatedBy", fields: [updatedById], references: [id])
  category      Category?  @relation(fields: [categoryId], references: [id])

  @@map("posts")
}

model Section {
  id        String      @id @default(uuid())
  pageId    String      @map("page_id")
  type      SectionType
  order     Int
  content   Json
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  page      Page        @relation(fields: [pageId], references: [id], onDelete: Cascade)

  @@unique([pageId, order])
  @@map("sections")
}

model Media {
  id          String   @id @default(uuid())
  filename    String
  originalName String  @map("original_name")
  mimeType    String   @map("mime_type")
  size        Int
  path        String
  url         String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  uploadedById String? @map("uploaded_by_id")

  uploadedBy  User?    @relation("MediaUploadedBy", fields: [uploadedById], references: [id])

  @@map("media")
}

model Menu {
  id        String     @id @default(uuid())
  name      String     @unique
  location  String     @unique // e.g., "header", "footer", "top-bar"
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt

  items     MenuItem[]

  @@map("menus")
}

model MenuItem {
  id        String   @id @default(uuid())
  menuId    String   @map("menu_id")
  label     String
  url       String
  order     Int
  parentId  String?  @map("parent_id")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  menu      Menu     @relation(fields: [menuId], references: [id], onDelete: Cascade)
  parent    MenuItem? @relation("MenuItemParent", fields: [parentId], references: [id])
  children  MenuItem[] @relation("MenuItemParent")

  @@unique([menuId, order])
  @@map("menu_items")
}

model SiteSettings {
  id        String   @id @default(uuid())
  key       String   @unique
  value     String   @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("site_settings")
}

enum AdPosition {
  HEADER
  SIDEBAR
  FOOTER
  IN_CONTENT
  BOTTOM_BANNER
}

enum AdStatus {
  ACTIVE
  INACTIVE
}

model Advertisement {
  id          String     @id @default(uuid())
  title       String
  description String?   @db.Text
  imageUrl    String    @map("image_url")
  linkUrl     String?   @map("link_url")
  position    AdPosition
  status      AdStatus  @default(ACTIVE)
  order       Int       @default(0)
  startDate   DateTime? @map("start_date")
  endDate     DateTime? @map("end_date")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@map("advertisements")
}
